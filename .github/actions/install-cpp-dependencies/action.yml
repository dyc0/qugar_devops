name: "Install C++ Dependencies"
description: "Install C++ dependencies for build and test jobs"
inputs:
  os:
    description: "Operating system"
    required: true
    type: string
runs:
  using: "composite"
  steps:
    - name: Show runner info
      shell: bash -el {0}
      run: |
        echo "Running on OS: ${{ runner.os }}"
        echo "Runner name: ${{ runner.name }}"
    
    - name: Setup Miniconda
      uses: conda-incubator/setup-miniconda@v3
      with:
        auto-update-conda: true
        activate-environment: QUGaR
        channels: conda-forge
        channel-priority: strict
    
    - name: Install dependencies via conda
      shell: bash -el {0}
      run: |
        conda install -y cmake ninja liblapacke openblas catch2
        
    - name: Verify installations (Linux/macOS)
      shell: bash -el {0}
      if: runner.os != 'Windows'
      run: |
        cmake --version
        ninja --version
        ls $CONDA_PREFIX/include/lapacke.h
        ls $CONDA_PREFIX/lib/cmake/Catch2

    - name: Check dependencies (Windows)
      if: runner.os == 'Windows'
      shell: pwsh
      run: |
        cmake --version
        ninja --version
        Test-Path "$env:CONDA_PREFIX\include\lapacke.h"
        Test-Path "$env:CONDA_PREFIX\lib\cmake\Catch2"
